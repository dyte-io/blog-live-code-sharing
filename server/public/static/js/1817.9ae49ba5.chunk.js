"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[1817],{1817:function(e,t,i){i.r(t),i.d(t,{dyte_chat:function(){return v}});var n=i(2982),a=i(4942),s=i(5671),r=i(3144),c=i(325),o=i(7239),d=i(859),l=i(9666),u=i(4153),h=i(1654),p=i(2576),v=(i(4130),function(){function e(t){var i=this;(0,s.Z)(this,e),(0,c.r)(this,t),this.disconnectMeeting=function(e){var t;i.isPrivateChatSupported()&&(null===e||void 0===e||e.participants.joined.removeListener("participantsUpdate",i.onParticipantUpdate),null===e||void 0===e||e.participants.joined.addListener("participantLeft",i.onParticipantUpdate)),null===(t=null===e||void 0===e?void 0:e.chat)||void 0===t||t.removeListener("chatUpdate",i.chatUpdateListener)},this.onParticipantUpdate=function(){i.participants=i.meeting.participants.joined.toArray(),i.selectedParticipant&&!i.participants.includes(i.selectedParticipant)&&(i.selectedParticipant=null,i.chatRecipientId=i.selectedGroup="everyone")},this.updateUnreadCountGroups=function(e){i.unreadCountGroups=Object.assign(Object.assign({},i.unreadCountGroups),e)},this.isPrivateChatSupported=function(){var e,t,n;return i.canPrivateMessage&&!i.disablePrivateChat&&"socket-service"===(null===(n=null===(t=null===(e=i.meeting)||void 0===e?void 0:e.__internals__)||void 0===t?void 0:t.features)||void 0===n?void 0:n.getFeatureValue("chat_socket_server"))},this.updateRecipients=function(e){if("string"===typeof e.detail)i.chatRecipientId="everyone",i.selectedParticipant=null;else{var t=e.detail.userId;i.chatRecipientId=t,i.selectedParticipant=i.participants.find((function(e){return e.userId===t}))}if("everyone"!==i.chatRecipientId){var n=[i.chatRecipientId,i.meeting.self.userId],s=(0,l.g)(n);i.selectedGroup=s}else i.selectedGroup="everyone";i.updateUnreadCountGroups((0,a.Z)({},i.selectedGroup,0))},this.isTextMessagingAllowed=function(){return"everyone"===i.chatRecipientId?i.canSend&&i.canSendTextMessage:i.canPrivateMessage&&i.canSendPrivateTexts},this.isFileMessagingAllowed=function(){return"everyone"===i.chatRecipientId?i.canSend&&i.canSendFiles:i.canPrivateMessage&&i.canSendPrivateFiles},this.meeting=void 0,this.config=h.d,this.size=void 0,this.iconPack=o.d,this.t=(0,d.u)(),this.disablePrivateChat=!1,this.privatePresetFilter=[],this.unreadCountGroups={},this.chatGroups={everyone:[]},this.selectedGroup="everyone",this.now=new Date,this.dropzoneActivated=!1,this.showLatestMessageButton=!1,this.canSend=!1,this.canSendTextMessage=!1,this.canSendFiles=!1,this.canPrivateMessage=!1,this.canSendPrivateTexts=!1,this.canSendPrivateFiles=!1,this.emojiPickerEnabled=!1,this.chatRecipientId="everyone",this.participants=[],this.selectedParticipant=void 0}return(0,r.Z)(e,[{key:"connectedCallback",value:function(){var e=this;this.meetingChanged(this.meeting),this.meeting&&!this.meeting.chat||this.isFileMessagingAllowed()&&(this.host.addEventListener("dragover",(function(t){t.preventDefault(),e.dropzoneActivated=!0})),this.host.addEventListener("dragleave",(function(){e.dropzoneActivated=!1})),this.host.addEventListener("drop",(function(t){t.preventDefault(),e.dropzoneActivated=!1,(0,l.h)(t.dataTransfer.items,(function(t,i){var n,a,s,r;switch(t){case"image":e.isFileMessagingAllowed()&&(null===(a=null===(n=e.meeting)||void 0===n?void 0:n.chat)||void 0===a||a.sendImageMessage(i,e.getRecipientPeerIds()));break;case"file":e.isFileMessagingAllowed()&&(null===(r=null===(s=e.meeting)||void 0===s?void 0:s.chat)||void 0===r||r.sendFileMessage(i,e.getRecipientPeerIds()))}}))})))}},{key:"disconnectedCallback",value:function(){this.disconnectMeeting(this.meeting)}},{key:"meetingChanged",value:function(e,t){var i,n,a,s,r,c=this;void 0!=t&&this.disconnectMeeting(t),e&&!e.chat||null!=e&&(this.canSend=e.self.permissions.chatPublic.canSend,this.canSendTextMessage=e.self.permissions.chatPublic.text,this.canSendFiles=e.self.permissions.chatPublic.files,this.canPrivateMessage=(null===(i=e.self.permissions.chatPrivate)||void 0===i?void 0:i.canSend)||(null===(n=e.self.permissions.chatPrivate)||void 0===n?void 0:n.canReceive),this.canSendPrivateTexts=null===(a=e.self.permissions.chatPrivate)||void 0===a?void 0:a.text,this.canSendPrivateFiles=null===(s=e.self.permissions.chatPrivate)||void 0===s?void 0:s.files,this.initializeChatGroups(),this.chatGroups=Object.assign({},this.chatGroups),this.chatUpdateListener=function(e){var t=e.message;c.addToChatGroup(t),c.chatGroups=Object.assign({},c.chatGroups)},this.onParticipantUpdate(),null===(r=e.chat)||void 0===r||r.addListener("chatUpdate",this.chatUpdateListener),this.isPrivateChatSupported()&&(e.participants.joined.addListener("participantJoined",this.onParticipantUpdate),e.participants.joined.addListener("participantLeft",this.onParticipantUpdate)))}},{key:"chatGroupsChanged",value:function(e){var t,i,n=this;if(this.isPrivateChatSupported()){var a={},s=function(){var s=null!==(t=u.c[r])&&void 0!==t?t:0;a[r]=e[r].filter((function(e){return"chat"==e.type&&e.message.time>s&&e.message.userId!==n.meeting.self.userId})).length,(r===(0,l.g)([n.meeting.self.userId,null===(i=n.selectedParticipant)||void 0===i?void 0:i.userId])||"everyone"===r&&null===n.selectedParticipant)&&(a[r]=0,u.c[r]=new Date)};for(var r in e)s();this.updateUnreadCountGroups(a)}}},{key:"initializeChatGroups",value:function(){var e,t=this;null===(e=this.meeting.chat)||void 0===e||e.messages.forEach((function(e){t.addToChatGroup(e)}))}},{key:"addToChatGroup",value:function(e){var t,i=(0,l.p)(e),a="everyone";if((null===(t=i.targetUserIds)||void 0===t?void 0:t.length)>0){var s=new Set([i.userId].concat((0,n.Z)(i.targetUserIds)));a=(0,l.g)(Array.from(s))}void 0===this.chatGroups[a]&&(this.chatGroups[a]=[]),this.chatGroups[a]=[].concat((0,n.Z)(this.chatGroups[a]),[{type:"chat",message:i}])}},{key:"getRecipientPeerIds",value:function(){var e=[];return"everyone"!==this.chatRecipientId&&(e=[this.selectedParticipant.id]),e}},{key:"render",value:function(){var e,t,i,n,a=this,s={iconPack:this.iconPack,t:this.t,size:this.size},r=null===(e=this.meeting)||void 0===e?void 0:e.self.userId,o=this.chatGroups[this.selectedGroup]||[];return(0,c.h)(c.H,null,this.isFileMessagingAllowed()&&(0,c.h)("div",{id:"dropzone",class:{active:this.dropzoneActivated},part:"dropzone"},(0,c.h)("dyte-icon",{icon:this.iconPack.attach,iconPack:this.iconPack,t:this.t}),(0,c.h)("p",null,this.t("Drop files/images to send"))),this.isPrivateChatSupported()&&(0,c.h)("dyte-chat-selector-ui",Object.assign({selfUserId:r,groups:this.participants,selectedGroupId:null===(t=this.selectedParticipant)||void 0===t?void 0:t.userId,unreadCounts:this.unreadCountGroups,onDyteChatGroupChanged:this.updateRecipients},s)),(0,c.h)("dyte-chat-messages-ui",Object.assign({messages:o,selfUserId:r,selectedGroup:this.selectedGroup},s)),(0,c.h)("dyte-chat-composer-ui",Object.assign({canSendTextMessage:this.isTextMessagingAllowed(),canSendFiles:this.isFileMessagingAllowed(),disableEmojiPicker:!!(null===(n=null===(i=this.meeting)||void 0===i?void 0:i.__internals__)||void 0===n?void 0:n.features.hasFeature(p.F.DISABLE_EMOJI_PICKER)),onDyteNewMessage:function(e){var t,i,n,s,r,c,o=e.detail;switch(o.type){case"text":null===(i=null===(t=a.meeting)||void 0===t?void 0:t.chat)||void 0===i||i.sendTextMessage(o.message,a.getRecipientPeerIds());break;case"image":null===(s=null===(n=a.meeting)||void 0===n?void 0:n.chat)||void 0===s||s.sendImageMessage(o.file,a.getRecipientPeerIds());break;case"file":null===(c=null===(r=a.meeting)||void 0===r?void 0:r.chat)||void 0===c||c.sendFileMessage(o.file,a.getRecipientPeerIds())}}},s),(0,c.h)("slot",{name:"chat-addon",slot:"chat-addon"})))}},{key:"host",get:function(){return(0,c.g)(this)}}],[{key:"watchers",get:function(){return{meeting:["meetingChanged"],chatGroups:["chatGroupsChanged"]}}}]),e}());v.style=":host{display:flex;height:100%;width:100%;flex-direction:column;font-family:var(--dyte-font-family, sans-serif);font-size:14px;color:rgb(var(--dyte-colors-text-1000, 255 255 255))}h3{margin:var(--dyte-space-0, 0px);display:flex;height:var(--dyte-space-12, 48px);align-items:center;justify-content:center;font-size:16px;font-weight:400;color:rgb(var(--dyte-colors-text-900, 255 255 255 / 0.88));text-align:center}#dropzone{position:absolute;top:var(--dyte-space-0, 0px);right:var(--dyte-space-0, 0px);bottom:var(--dyte-space-0, 0px);left:var(--dyte-space-0, 0px);z-index:10;display:none;flex-direction:column;align-items:center;justify-content:center;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-800, 30 30 30) / var(--tw-bg-opacity));color:rgb(var(--dyte-colors-text-700, 255 255 255 / 0.64))}#dropzone.active{display:flex;-webkit-animation:0.2s slide-up ease-in;animation:0.2s slide-up ease-in}dyte-chat-messages-ui{flex:1 0 0}"},2576:function(e,t,i){i.d(t,{F:function(){return n}});var n={PLAY_PARTICIPANT_TILE_VIDEO_ON_PAUSE:"play_participant_tile_video_on_pause",DISABLE_EMOJI_PICKER:"disable_emoji_picker"}},859:function(e,t,i){i.d(t,{g:function(){return r},u:function(){return c}});var n=i(4165),a=i(5861),s=i(7239),r=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&"en"!==t&&""!==t.trim()){e.next=2;break}return e.abrupt("return",s.a);case 2:return e.prev=2,e.next=5,fetch("".concat("http://localhost:5000","/").concat(t,".json"));case 5:if((i=e.sent).ok){e.next=8;break}return e.abrupt("return",s.a);case 8:return e.t0=Object,e.t1={},e.t2=s.a,e.next=13,i.json();case 13:return e.t3=e.sent,e.abrupt("return",e.t0.assign.call(e.t0,e.t1,e.t2,e.t3));case 17:return e.prev=17,e.t4=e.catch(2),e.abrupt("return",s.a);case 20:case"end":return e.stop()}}),e,null,[[2,17]])})));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.a;return function(t){var i;return null!==(i=e[t])&&void 0!==i?i:t}}}}]);
//# sourceMappingURL=1817.9ae49ba5.chunk.js.map