"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[9244],{9244:function(t,e,i){i.r(e),i.d(e,{dyte_audio_visualizer:function(){return v},dyte_switch:function(){return k}});var a,n=i(5671),r=i(3144),s=i(7762),c=i(2982),o=i(325),l=i(7239),h=i(859),d=u;function u(){}u.mixin=function(t){var e=t.prototype||t;e.isWildEmitter=!0,e.on=function(t,e,i){this.callbacks=this.callbacks||{};var a=3===arguments.length,n=a?arguments[1]:void 0,r=a?arguments[2]:arguments[1];return r._groupName=n,(this.callbacks[t]=this.callbacks[t]||[]).push(r),this},e.once=function(t,e,i){var a=this,n=3===arguments.length,r=n?arguments[1]:void 0,s=n?arguments[2]:arguments[1];return this.on(t,r,(function e(){a.off(t,e),s.apply(this,arguments)})),this},e.releaseGroup=function(t){var e,i,a,n;for(e in this.callbacks=this.callbacks||{},this.callbacks)for(i=0,a=(n=this.callbacks[e]).length;i<a;i++)n[i]._groupName===t&&(n.splice(i,1),i--,a--);return this},e.off=function(t,e){this.callbacks=this.callbacks||{};var i,a=this.callbacks[t];return a?1===arguments.length?(delete this.callbacks[t],this):(-1!==(i=a.indexOf(e))&&(a.splice(i,1),0===a.length&&delete this.callbacks[t]),this):this},e.emit=function(t){this.callbacks=this.callbacks||{};var e,i,a,n=[].slice.call(arguments,1),r=this.callbacks[t],s=this.getWildcardCallbacks(t);if(r)for(e=0,i=(a=r.slice()).length;e<i&&a[e];++e)a[e].apply(this,n);if(s)for(i=s.length,e=0,i=(a=s.slice()).length;e<i&&a[e];++e)a[e].apply(this,[t].concat(n));return this},e.getWildcardCallbacks=function(t){this.callbacks=this.callbacks||{};var e,i,a=[];for(e in this.callbacks)i=e.split("*"),("*"===e||2===i.length&&t.slice(0,i[0].length)===i[0])&&(a=a.concat(this.callbacks[e]));return a}},u.mixin(u),"undefined"!==typeof window&&(a=window.AudioContext||window.webkitAudioContext);var p=null,f=function(t,e){if(null!=t){var i=Math.round(1.5),a=(0,c.Z)(Array(3)).map((function(t,a){var n=a;return n>i-1&&(n=3-n-1),Math.round((n+1)/(i+1)*e)})),n=t.width,r=t.height,o=t.getContext("2d"),l=2,h=1*n/a.length,d=h-4;o.clearRect(0,0,n,r),o.fillStyle="rgb(0,0,0,0.0)",o.fillRect(0,0,n,r);var u=getComputedStyle(t).getPropertyValue("color");o.fillStyle=u,o.strokeStyle=u,o.lineCap="round",o.lineWidth=4,o.beginPath();var p,f=(0,s.Z)(a);try{for(f.s();!(p=f.n()).done;){var v=p.value,k=Math.min(-Math.abs(1.2*v/10*r)+r/2,r/2-2.5),y=Math.max(2*(r/2-k),5);o.moveTo(l+d/2,k),o.lineTo(l+d/2,k+y),l+=h}}catch(g){f.e(g)}finally{f.f()}o.stroke()}},v=function(){function t(e){(0,n.Z)(this,t),(0,o.r)(this,e),this.variant="bars",this.participant=void 0,this.size=void 0,this.iconPack=l.d,this.t=(0,h.u)(),this.isScreenShare=!1,this.audioEnabled=void 0,this.volume=0}return(0,r.Z)(t,[{key:"connectedCallback",value:function(){this.participantChanged(this.participant)}},{key:"componentDidLoad",value:function(){f(this.visualizer,0)}},{key:"disconnectedCallback",value:function(){var t,e,i;null===(t=this.hark)||void 0===t||t.stop(),this.audioUpdateListener&&(null===(e=this.participant)||void 0===e||e.removeListener("audioUpdate",this.audioUpdateListener)),this.screenShareUpdateListener&&(null===(i=this.participant)||void 0===i||i.removeListener("screenShareUpdate",this.screenShareUpdateListener))}},{key:"participantChanged",value:function(t){var e=this;null!=t&&(this.audioUpdateListener=function(t){var i,a=t.audioEnabled,n=t.audioTrack;if(null===(i=e.hark)||void 0===i||i.stop(),a&&null!=n){e.audioEnabled=!0;var r=new MediaStream;r.addTrack(n),e.calcVolume(r),f(e.visualizer,0)}else e.volume=0,e.audioEnabled=!1},this.isScreenShare?(this.screenShareUpdateListener=function(t){var i=t.screenShareEnabled,a=t.screenShareTracks;e.audioUpdateListener({audioEnabled:i&&null!=a.audio,audioTrack:a.audio})},this.screenShareUpdateListener(t),t.addListener("screenShareUpdate",this.screenShareUpdateListener)):(this.audioUpdateListener(t),t.addListener("audioUpdate",this.audioUpdateListener)))}},{key:"calcVolume",value:function(t){var e=this;this.hark=function(t,e){var i=new d;if(!a)return i;var n,r,s,c=(e=e||{}).smoothing||.1,o=e.interval||50,l=e.threshold,h=e.play,u=e.history||10,f=!0;p=e.audioContext||p||new a,(s=p.createAnalyser()).fftSize=512,s.smoothingTimeConstant=c,r=new Float32Array(s.frequencyBinCount),t.jquery&&(t=t[0]),t instanceof HTMLAudioElement||t instanceof HTMLVideoElement?(n=p.createMediaElementSource(t),"undefined"===typeof h&&(h=!0),l=l||-50):(n=p.createMediaStreamSource(t),l=l||-50),n.connect(s),h&&s.connect(p.destination),i.speaking=!1,i.suspend=function(){return p.suspend()},i.resume=function(){return p.resume()},Object.defineProperty(i,"state",{get:function(){return p.state}}),p.onstatechange=function(){i.emit("state_change",p.state)},i.setThreshold=function(t){l=t},i.setInterval=function(t){o=t},i.stop=function(){f=!1,i.emit("volume_change",-100,l),i.speaking&&(i.speaking=!1,i.emit("stopped_speaking")),s.disconnect(),n.disconnect()},i.speakingHistory=[];for(var v=0;v<u;v++)i.speakingHistory.push(0);return function t(){setTimeout((function(){if(f){var e=function(t,e){var i=-1/0;t.getFloatFrequencyData(e);for(var a=4,n=e.length;a<n;a++)e[a]>i&&e[a]<0&&(i=e[a]);return i}(s,r);i.emit("volume_change",e,l);var a=0;if(e>l&&!i.speaking){for(var n=i.speakingHistory.length-3;n<i.speakingHistory.length;n++)a+=i.speakingHistory[n];a>=2&&(i.speaking=!0,i.emit("speaking"))}else if(e<l&&i.speaking){for(n=0;n<i.speakingHistory.length;n++)a+=i.speakingHistory[n];0==a&&(i.speaking=!1,i.emit("stopped_speaking"))}i.speakingHistory.shift(),i.speakingHistory.push(0+(e>l)),t()}}),o)}(),i}(t,{play:!1,interval:100}),this.hark.on("volume_change",(function(t){var i=e.volume,a=Math.round(10*Math.pow(10,t/115));a<3&&(a=0);var n=Math.round((2*i+a)/3);i!==n&&(e.volume=n,f(e.visualizer,e.volume))}))}},{key:"render",value:function(){var t=this;return(0,o.h)(o.H,null,(0,o.h)("canvas",{width:"24",height:"24",class:{bars:!0,visible:this.audioEnabled},ref:function(e){return t.visualizer=e},part:"canvas"}),!this.isScreenShare&&!this.audioEnabled&&(0,o.h)("dyte-icon",{icon:this.iconPack.mic_off,part:"mic-off-icon",iconPack:this.iconPack,t:this.t}))}}],[{key:"watchers",get:function(){return{participant:["participantChanged"]}}}]),t}();v.style=":host{display:block;height:var(--dyte-space-6, 24px);width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;font-family:var(--dyte-font-family, sans-serif)}canvas,dyte-icon{height:var(--dyte-space-6, 24px);width:var(--dyte-space-6, 24px)}:host([size='sm']){transform:scale(0.9)}canvas{display:none}canvas.visible{display:block}canvas.bars{--tw-text-opacity:1;color:rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-text-opacity))}";var k=function(){function t(e){var i=this;(0,n.Z)(this,t),(0,o.r)(this,e),this.dyteChange=(0,o.c)(this,"dyteChange",4),this.onClick=function(){i.readonly||i.disabled||(i.checked=!i.checked)},this.onKeyPress=function(t){if(!i.readonly)switch(t.key){case"Enter":case" ":i.checked=!i.checked}},this.checked=!1,this.readonly=!1,this.disabled=!1,this.iconPack=l.d,this.t=(0,h.u)()}return(0,r.Z)(t,[{key:"checkedChange",value:function(t){this.dyteChange.emit(t)}},{key:"render",value:function(){return(0,o.h)(o.H,{role:"switch",tabIndex:this.disabled&&0,"aria-readonly":this.readonly,"aria-checked":this.checked,"aria-disabled":this.disabled,class:{checked:this.checked},onClick:this.onClick,onKeyPress:this.onKeyPress},(0,o.h)("div",{class:"switch",part:"switch"}))}}],[{key:"watchers",get:function(){return{checked:["checkedChange"]}}}]),t}();k.style=":host{box-sizing:border-box;display:inline-flex;height:var(--dyte-space-6, 24px);width:var(--dyte-space-10, 40px);align-items:center;padding:var(--dyte-space-1, 4px);border-radius:9999px;--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-700, 44 44 44) / var(--tw-bg-opacity));cursor:pointer}.switch{box-sizing:border-box;height:var(--dyte-space-4, 16px);width:var(--dyte-space-4, 16px);background-color:rgb(var(--dyte-colors-text-on-brand-1000, var(--dyte-colors-text-1000, 255 255 255)));border-radius:9999px;transition-property:var(--dyte-transition-property, all);transition-duration:200ms}:host(.checked){--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-bg-opacity))}:host(.checked) .switch{transform:translateX(100%)}:host([readonly]),:host([disabled]){cursor:not-allowed;opacity:0.6}"},859:function(t,e,i){i.d(e,{g:function(){return s},u:function(){return c}});var a=i(4165),n=i(5861),r=i(7239),s=function(){var t=(0,n.Z)((0,a.Z)().mark((function t(e){var i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=e&&"en"!==e&&""!==e.trim()){t.next=2;break}return t.abrupt("return",r.a);case 2:return t.prev=2,t.next=5,fetch("".concat("http://localhost:5000","/").concat(e,".json"));case 5:if((i=t.sent).ok){t.next=8;break}return t.abrupt("return",r.a);case 8:return t.t0=Object,t.t1={},t.t2=r.a,t.next=13,i.json();case 13:return t.t3=t.sent,t.abrupt("return",t.t0.assign.call(t.t0,t.t1,t.t2,t.t3));case 17:return t.prev=17,t.t4=t.catch(2),t.abrupt("return",r.a);case 20:case"end":return t.stop()}}),t,null,[[2,17]])})));return function(e){return t.apply(this,arguments)}}(),c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.a;return function(e){var i;return null!==(i=t[e])&&void 0!==i?i:e}}}}]);
//# sourceMappingURL=9244.bf207fa2.chunk.js.map