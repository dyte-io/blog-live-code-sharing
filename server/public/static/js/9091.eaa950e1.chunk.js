"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[9091],{9091:function(e,t,n){n.r(t),n.d(t,{dyte_screen_share_toggle:function(){return l}});var r=n(7762),i=n(5671),s=n(3144),a=n(325),o=n(7239),c=n(859),u=n(4402),h=n(5100),f=function(){return"undefined"!==typeof navigator&&"undefined"!==typeof navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices},l=function(){function e(t){var n=this;(0,i.Z)(this,e),(0,a.r)(this,t),this.stateUpdate=(0,a.c)(this,"dyteStateUpdate",7),this.selfScreenShareListener=function(e){var t=e.screenShareEnabled;n.screenShareEnabled=t},this.screenShareListener=function(e){var t=e.screenShareEnabled,r=n.screenShareCount+(t?1:-1);n.screenShareCount=Math.max(r,0)},this.participantLeftListener=function(e){e.screenShareEnabled&&(n.screenShareCount=Math.max(n.screenShareCount-1,0))},this.selfJoinStateListener=function(){n.updateCanProduce(n.meeting)},this.selfStageLeftListener=function(){n.canScreenShare=!1},this.selfJoinStateRejectedListener=function(){n.updateCanProduce(n.meeting)},this.mediaPermissionErrorListener=function(e){var t=e.kind,r=e.message;"screenshare"===t&&(n.shareScreenPermission=r)},this.reachedMaxScreenShares=function(){return n.maxScreenShareCount>0&&n.screenShareCount>=n.maxScreenShareCount},this.toggleScreenShare=function(){var e,t=null===(e=n.meeting)||void 0===e?void 0:e.self;null==t||!n.canScreenShare||n.reachedMaxScreenShares()||n.hasPermissionError()||(t.screenShareEnabled?t.disableScreenShare():t.enableScreenShare(),n.stateUpdate.emit({activeMoreMenu:!1}),h.s.activeMoreMenu=!1)},this.states=void 0,this.variant="button",this.meeting=void 0,this.size=void 0,this.iconPack=o.d,this.t=(0,c.u)(),this.maxScreenShareCount=-1,this.screenShareCount=0,this.screenShareEnabled=!1,this.canScreenShare=!1,this.shareScreenPermission="NOT_REQUESTED"}return(0,s.Z)(e,[{key:"connectedCallback",value:function(){f()?this.meetingChanged(this.meeting):u.l.error("[dyte-screenshare-toggle] Device does not support screensharing.")}},{key:"disconnectedCallback",value:function(){var e,t,n,r,i,s,a,o,c;null===(e=this.meeting)||void 0===e||e.participants.joined.removeListener("screenShareUpdate",this.screenShareListener),null===(t=this.meeting)||void 0===t||t.participants.joined.removeListener("participantLeft",this.participantLeftListener),null===(n=this.meeting)||void 0===n||n.self.removeListener("screenShareUpdate",this.selfScreenShareListener),null===(r=this.meeting)||void 0===r||r.self.removeListener("mediaPermissionError",this.mediaPermissionErrorListener),null===(i=this.meeting)||void 0===i||i.self.removeListener("joinStageRequestAccepted",this.selfJoinStateListener),null===(s=this.meeting)||void 0===s||s.self.removeListener("joinStageRequestRejected",this.selfJoinStateRejectedListener),null===(a=this.meeting)||void 0===a||a.self.removeListener("stageJoined",this.selfJoinStateListener),null===(o=this.meeting)||void 0===o||o.self.removeListener("stageLeft",this.selfStageLeftListener),null===(c=this.meeting)||void 0===c||c.self.removeListener("removedFromStage",this.selfJoinStateListener)}},{key:"meetingChanged",value:function(e){if(null!=e){var t=e.self;this.updateCanProduce(e),this.maxScreenShareCount=t.config.maxScreenShareCount,this.screenShareEnabled=t.screenShareEnabled;var n,i=0,s=(0,r.Z)(e.participants.joined.toArray());try{for(s.s();!(n=s.n()).done;){n.value.screenShareEnabled&&i++}}catch(a){s.e(a)}finally{s.f()}this.screenShareCount=i,e.participants.joined.addListener("screenShareUpdate",this.screenShareListener),e.participants.joined.addListener("participantLeft",this.participantLeftListener),t.addListener("screenShareUpdate",this.selfScreenShareListener),t.addListener("mediaPermissionError",this.mediaPermissionErrorListener),t.addListener("joinStageRequestAccepted",this.selfJoinStateListener),t.addListener("joinStageRequestRejected",this.selfJoinStateRejectedListener),t.addListener("stageJoined",this.selfJoinStateListener),t.addListener("stageLeft",this.selfStageLeftListener),t.addListener("removedFromStage",this.selfJoinStateListener)}}},{key:"updateCanProduce",value:function(e){var t=e.self,n=e.meta,r="ALLOWED"===t.permissions.canProduceScreenshare,i="WEBINAR"===n.viewType;if(this.canScreenShare=!1,r)this.canScreenShare=!0;else if(i){!("CAN_REQUEST"===t.permissions.canProduceScreenshare)||"ON_STAGE"!==t.webinarStageStatus&&"ACCEPTED_TO_JOIN_STAGE"!==t.webinarStageStatus||(this.canScreenShare=!0)}}},{key:"hasPermissionError",value:function(){return"SYSTEM_DENIED"===this.shareScreenPermission||"COULD_NOT_START"===this.shareScreenPermission}},{key:"getState",value:function(){var e="",t="",n="",r={},i=this.hasPermissionError(),s=this.reachedMaxScreenShares();return this.screenShareEnabled&&!i?(t=this.t("share_screen_stop"),n=this.iconPack.share_screen_stop,r["red-icon"]=!0):(t=this.t("share_screen_start"),n=this.iconPack.share_screen_start),"SYSTEM_DENIED"===this.shareScreenPermission?(e=this.t("perm_sys_denied"),r["red-icon"]=!0):e=t,s&&(e=this.t("Maximum screen share limit reached")),{tooltipLabel:e,label:t,icon:n,classList:r,showWarning:i||s}}},{key:"render",value:function(){if(!f()||!this.canScreenShare)return null;var e=this.getState(),t=e.tooltipLabel,n=e.label,r=e.icon,i=e.classList,s=e.showWarning;return(0,a.h)(a.H,{title:n},(0,a.h)("dyte-tooltip",{placement:"top",kind:"block",label:t,delay:600,part:"tooltip",iconPack:this.iconPack,t:this.t},(0,a.h)("dyte-controlbar-button",{part:"controlbar-button",size:this.size,iconPack:this.iconPack,t:this.t,variant:this.variant,label:n,icon:r,class:i,onClick:this.toggleScreenShare,disabled:s,showWarning:s})))}}],[{key:"watchers",get:function(){return{meeting:["meetingChanged"]}}}]),e}();l.style=":host{display:block;font-family:var(--dyte-font-family, sans-serif)}"},859:function(e,t,n){n.d(t,{g:function(){return a},u:function(){return o}});var r=n(4165),i=n(5861),s=n(7239),a=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&"en"!==t&&""!==t.trim()){e.next=2;break}return e.abrupt("return",s.a);case 2:return e.prev=2,e.next=5,fetch("".concat("http://localhost:5000","/").concat(t,".json"));case 5:if((n=e.sent).ok){e.next=8;break}return e.abrupt("return",s.a);case 8:return e.t0=Object,e.t1={},e.t2=s.a,e.next=13,n.json();case 13:return e.t3=e.sent,e.abrupt("return",e.t0.assign.call(e.t0,e.t1,e.t2,e.t3));case 17:return e.prev=17,e.t4=e.catch(2),e.abrupt("return",s.a);case 20:case"end":return e.stop()}}),e,null,[[2,17]])})));return function(t){return e.apply(this,arguments)}}(),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.a;return function(t){var n;return null!==(n=e[t])&&void 0!==n?n:t}}},5100:function(e,t,n){n.d(t,{o:function(){return f},s:function(){return h}});var r=n(7762),i=n(325),s=function(e){return!("isConnected"in e)||e.isConnected},a=function(e,t){var n;return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];n&&clearTimeout(n),n=setTimeout((function(){n=0,e.apply(void 0,i)}),t)}}((function(e){var t,n=(0,r.Z)(e.keys());try{for(n.s();!(t=n.n()).done;){var i=t.value;e.set(i,e.get(i).filter(s))}}catch(a){n.e(a)}finally{n.f()}}),2e3),o=function(e){return"function"===typeof e?e():e},c=function(e,t){var n=e.indexOf(t);n>=0&&(e[n]=e[e.length-1],e.length--)},u=function(e,t){var n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,t){return e!==t},n=o(e),r=new Map(Object.entries(null!==n&&void 0!==n?n:{})),i={dispose:[],get:[],set:[],reset:[]},s=function(){var t;r=new Map(Object.entries(null!==(t=o(e))&&void 0!==t?t:{})),i.reset.forEach((function(e){return e()}))},a=function(e){return i.get.forEach((function(t){return t(e)})),r.get(e)},u=function(e,n){var s=r.get(e);t(n,s,e)&&(r.set(e,n),i.set.forEach((function(t){return t(e,n,s)})))},h="undefined"===typeof Proxy?{}:new Proxy(n,{get:function(e,t){return a(t)},ownKeys:function(e){return Array.from(r.keys())},getOwnPropertyDescriptor:function(){return{enumerable:!0,configurable:!0}},has:function(e,t){return r.has(t)},set:function(e,t,n){return u(t,n),!0}}),f=function(e,t){return i[e].push(t),function(){c(i[e],t)}};return{state:h,get:a,set:u,on:f,onChange:function(t,n){var r=f("set",(function(e,r){e===t&&n(r)})),i=f("reset",(function(){return n(o(e)[t])}));return function(){r(),i()}},use:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce((function(e,t){return t.set&&e.push(f("set",t.set)),t.get&&e.push(f("get",t.get)),t.reset&&e.push(f("reset",t.reset)),t.dispose&&e.push(f("dispose",t.dispose)),e}),[]);return function(){return r.forEach((function(e){return e()}))}},dispose:function(){i.dispose.forEach((function(e){return e()})),s()},reset:s,forceUpdate:function(e){var t=r.get(e);i.set.forEach((function(n){return n(e,t,t)}))}}}(e,t);return n.use(function(){if("function"!==typeof i.a)return{};var e=new Map;return{dispose:function(){return e.clear()},get:function(t){var n=(0,i.a)();n&&function(e,t,n){var r=e.get(t);r?r.includes(n)||r.push(n):e.set(t,[n])}(e,t,n)},set:function(t){var n=e.get(t);n&&e.set(t,n.filter(i.f)),a(e)},reset:function(){e.forEach((function(e){return e.forEach(i.f)})),a(e)}}}()),n}({}),h=u.state,f=u.onChange}}]);
//# sourceMappingURL=9091.eaa950e1.chunk.js.map