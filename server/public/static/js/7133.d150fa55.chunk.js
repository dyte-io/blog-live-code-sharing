"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[7133],{7133:function(e,t,i){i.r(t),i.d(t,{dyte_participants_audio:function(){return p}});var a=i(7762),r=i(4165),n=i(5861),o=i(5671),s=i(3144),c=i(325),u=i(4402),d=i(859),h=i(7239),l=function(){function e(){(0,o.Z)(this,e),this.audio=document.createElement("audio"),this.audio.autoplay=!0,this.audioStream=new MediaStream,this.audio.srcObject=this.audioStream,this.audioTracks=[]}return(0,s.Z)(e,[{key:"addTrack",value:function(e,t){this.audioTracks.some((function(t){return t.id===e}))||(this.audioTracks.push({id:e,track:t}),this.audioStream.addTrack(t),this.play())}},{key:"removeTrack",value:function(e){var t=this.audioTracks.find((function(t){return t.id===e}));null!=t&&(this.audioStream.removeTrack(t.track),this.audioTracks=this.audioTracks.filter((function(t){return t.id!==e})))}},{key:"play",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(){var t,i=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.audio.srcObject=this.audioStream,e.next=3,null===(t=this.audio.play())||void 0===t?void 0:t.catch((function(e){"NotAllowedError"===e.name?null!=i._onError&&i._onError():"AbortError"!==e.name&&u.l.error("[dyte-audio] play() error\n",e)}));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setDevice",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t){var i,a,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=null===(a=(i=this.audio).setSinkId)||void 0===a?void 0:a.call(i,t))||void 0===n?void 0:n.catch((function(e){u.l.error("[dyte-audio] setSinkId() error\n",e)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onError",value:function(e){this._onError=e}}]),e}(),p=function(){function e(t){(0,o.Z)(this,e),(0,c.r)(this,t),this.meeting=void 0,this.iconPack=h.d,this.t=(0,d.u)(),this.showPlayDialog=!1}return(0,s.Z)(e,[{key:"componentDidLoad",value:function(){this.meetingChanged(this.meeting)}},{key:"disconnectedCallback",value:function(){null!=this.meeting&&(this.audioUpdateListener&&this.meeting.participants.active.removeListener("audioUpdate",this.audioUpdateListener),this.screenShareUpdateListener&&this.meeting.participants.joined.removeListener("screenShareUpdate",this.screenShareUpdateListener),this.participantLeftListener&&this.meeting.participants.joined.removeListener("participantLeft",this.participantLeftListener),this.deviceUpdateListener&&this.meeting.self.removeListener("deviceUpdate",this.deviceUpdateListener))}},{key:"meetingChanged",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t){var i,n,o,s,c,u=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t){e.next=19;break}if(this.audio=new l,this.audio.onError((function(){u.showPlayDialog=!0})),this.audio.play(),null==(i=t.self.getCurrentDevices()).speaker){e.next=8;break}return e.next=8,this.audio.setDevice(i.speaker.deviceId);case 8:this.audioUpdateListener=function(e){var t=e.id,i=e.audioEnabled,a=e.audioTrack,r="audio-".concat(t);i&&null!=a?u.audio.addTrack(r,a):u.audio.removeTrack(r)},n=t.participants.joined.toArray(),o=(0,a.Z)(n);try{for(o.s();!(s=o.n()).done;)c=s.value,this.audioUpdateListener(c)}catch(r){o.e(r)}finally{o.f()}this.participantLeftListener=function(e){var t=e.id;u.audio.removeTrack("audio-".concat(t)),u.audio.removeTrack("screenshare-".concat(t))},this.screenShareUpdateListener=function(e){var t=e.id,i=e.screenShareEnabled,a=e.screenShareTracks,r="screenshare-".concat(t);i&&null!=a.audio?u.audio.addTrack(r,a.audio):u.audio.removeTrack(r)},this.deviceUpdateListener=function(e){var t=e.device;e.preview||"audiooutput"===t.kind&&u.audio.setDevice(t.deviceId)},t.participants.joined.addListener("audioUpdate",this.audioUpdateListener),t.participants.joined.addListener("screenShareUpdate",this.screenShareUpdateListener),t.participants.joined.addListener("participantLeft",this.participantLeftListener),t.self.addListener("deviceUpdate",this.deviceUpdateListener);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return(0,c.h)(c.H,null,this.showPlayDialog&&(0,c.h)("dyte-dialog",{open:!0,onDyteDialogClose:function(){e.showPlayDialog=!1},iconPack:this.iconPack,t:this.t},(0,c.h)("div",{class:"modal"},(0,c.h)("h3",null,this.t("Allow Audio Playback")),(0,c.h)("p",null,this.t("In order to play audio properly on your device, click the button below")),(0,c.h)("dyte-button",{kind:"wide",onClick:function(){e.audio.play(),e.showPlayDialog=!1},title:this.t("Play Audio"),iconPack:this.iconPack,t:this.t},this.t("Play Audio")))))}}],[{key:"watchers",get:function(){return{meeting:["meetingChanged"]}}}]),e}();p.style=":host{display:block;font-family:var(--dyte-font-family, sans-serif);color:rgb(var(--dyte-colors-text-1000, 255 255 255))}.modal{box-sizing:border-box;width:100%;max-width:var(--dyte-space-96, 384px);padding:var(--dyte-space-4, 16px);border-radius:var(--dyte-border-radius-md, 8px);--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-background-1000, 8 8 8) / var(--tw-bg-opacity))}.modal h3{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px);font-size:24px;font-weight:500}.modal p{margin-top:var(--dyte-space-4, 16px);margin-bottom:var(--dyte-space-6, 24px)}.modal dyte-button{width:100%}"},859:function(e,t,i){i.d(t,{g:function(){return o},u:function(){return s}});var a=i(4165),r=i(5861),n=i(7239),o=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){var i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&"en"!==t&&""!==t.trim()){e.next=2;break}return e.abrupt("return",n.a);case 2:return e.prev=2,e.next=5,fetch("".concat("http://localhost:5000","/").concat(t,".json"));case 5:if((i=e.sent).ok){e.next=8;break}return e.abrupt("return",n.a);case 8:return e.t0=Object,e.t1={},e.t2=n.a,e.next=13,i.json();case 13:return e.t3=e.sent,e.abrupt("return",e.t0.assign.call(e.t0,e.t1,e.t2,e.t3));case 17:return e.prev=17,e.t4=e.catch(2),e.abrupt("return",n.a);case 20:case"end":return e.stop()}}),e,null,[[2,17]])})));return function(t){return e.apply(this,arguments)}}(),s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.a;return function(t){var i;return null!==(i=e[t])&&void 0!==i?i:t}}}}]);
//# sourceMappingURL=7133.d150fa55.chunk.js.map